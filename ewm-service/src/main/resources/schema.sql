DROP TABLE IF EXISTS event_compilation;
DROP TABLE IF EXISTS events;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS categories;
DROP TABLE IF EXISTS requests;
DROP TABLE IF EXISTS compilations;

CREATE TABLE IF NOT EXISTS users(
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
name VARCHAR(255) NOT NULL,
email VARCHAR(255) NOT NULL,
CONSTRAINT UQ_USER_EMAIL UNIQUE (email),
PRIMARY KEY(id)
);

CREATE TABLE IF NOT EXISTS categories(
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
name VARCHAR(255) NOT NULL,
PRIMARY KEY(id)
);

CREATE TABLE IF NOT EXISTS events(
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
annotation VARCHAR NOT NULL,
category_id BIGINT NOT NULL,
confirmed_requests INT NOT NULL,
created TIMESTAMP NOT NULL,
description VARCHAR NOT NULL,
event_date TIMESTAMP NOT NULL,
initiator_id BIGINT NOT NULL,
paid BOOLEAN NOT NULL,
participant_limit INT NOT NULL,
published TIMESTAMP,
request_moderation BOOLEAN NOT NULL,
state VARCHAR(20) NOT NULL,
title VARCHAR(255) NOT NULL,
views BIGINT NOT NULL,
location JSONB NOT NULL,
PRIMARY KEY(id),
FOREIGN KEY (initiator_id) REFERENCES users (id) ON DELETE CASCADE,
FOREIGN KEY (category_id) REFERENCES categories (id) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS requests(
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
event_id BIGINT NOT NULL,
requester_id BIGINT NOT NULL,
created TIMESTAMP NOT NULL,
status VARCHAR(20) NOT NULL,
PRIMARY KEY(id)
);

CREATE TABLE IF NOT EXISTS compilations(
id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
pinned BOOLEAN NOT NULL,
title VARCHAR NOT NULL,
PRIMARY KEY(id)
);

CREATE TABLE IF NOT EXISTS event_compilation(
event_id BIGINT NOT NULL,
compilation_id BIGINT NOT NULL,
FOREIGN KEY (event_id) REFERENCES events (id) ON DELETE CASCADE,
FOREIGN KEY (compilation_id) REFERENCES compilations (id) ON DELETE CASCADE
);

